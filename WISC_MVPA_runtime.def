Bootstrap: docker
From: mathworks/matlab-runtime-deps:r2023b
# the lines above set the base container image

%files
	# compiled code
	WISC_MVPA /
%post
	# grant /tmp directory read/write permissions
	chmod 777 /tmp
	# install useful things
	apt-get update -y
	apt-get install -y \
	wget \
	nano
	# download runtime
	mkdir /opt/runtime
	cd /opt 
	wget -q https://ssd.mathworks.com/supportfiles/downloads/R2023b/Release/10/deployment_files/installer/complete/glnxa64/MATLAB_Runtime_R2023b_Update_10_glnxa64.zip
	# unzip runtime
	unzip /opt/MATLAB_Runtime_R2023b_Update_10_glnxa64.zip -d /opt/runtime 
	# make installer input file
	cat <<EOF > /opt/runtime/installer_input.txt
agreeToLicense=yes
outputFile=/opt/runtime/runtime_install.log
destinationFolder=/opt/matlab_runtime/
mode=silent
EOF

	# install
	cd /opt/runtime
	./install -inputFile installer_input.txt
		
	# clean up
	rm /opt/MATLAB_Runtime_R2023b_Update_10_glnxa64.zip
	rm -r /opt/runtime 

	# set up runtime cache
	mkdir -p /tmp/mcr-cache-$USER
	chmod -R 777 /tmp/mcr-cache-$USER

	# make compiled code executable
	chmod +x /WISC_MVPA

%environment
	
	# add runtime to path
	export LD_LIBRARY_PATH=/opt/matlab_runtime/R2023b/runtime/glnxa64:/opt/matlab_runtime/R2023b/bin/glnxa64:$LD_LIBRARY_PATH
	# add runtime cache to path
	export MCR_CACHE_ROOT=/tmp/mcr-cache-$USER
	export TMPDIR=/tmp
